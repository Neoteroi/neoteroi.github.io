
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="The official documentation website of BlackSheep, a fast ASGI web framework for Python asyncio.">
      
      
        <meta name="author" content="Roberto Prevato">
      
      
        <link rel="canonical" href="https://www.neoteroi.dev/blacksheep/authorization/">
      
      
        <link rel="prev" href="/blacksheep/authentication/">
      
      
        <link rel="next" href="/blacksheep/openid-connect/">
      
      <link rel="icon" href="/blacksheep/img/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.18">
    
    
      
        <title>Authorization - BlackSheep</title>
      
    
    
      <link rel="stylesheet" href="/blacksheep/assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="/blacksheep/assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="/blacksheep/css/neoteroi.css">
    
      <link rel="stylesheet" href="/blacksheep/css/extra.css?v=20221120">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-T65MX5XNF2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-T65MX5XNF2');
</script>

    
    
  
  
    
  
  
  <meta property="og:type" content="website">
  <meta property="og:title" content="BlackSheep - Authorization">
  <meta property="og:description" content="The official documentation website of BlackSheep, a fast ASGI web framework for Python asyncio.">
  <meta property="og:url" content="https://www.neoteroi.dev/blacksheep/authorization/">
  <meta property="og:image" content="https://www.neoteroi.dev/blacksheep/img/banner.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:image:width" content="1080">
  <meta property="og:image:height" content="568">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@RobertoPrevato">
  <meta name="twitter:creator" content="@RobertoPrevato">
  <meta name="twitter:title" content="BlackSheep - Authorization">
  <meta name="twitter:description" content="The official documentation website of BlackSheep, a fast ASGI web framework for Python asyncio.">
  <meta name="twitter:image" content="https://www.neoteroi.dev/blacksheep/img/banner.png">

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#authorization-in-blacksheep" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="/blacksheep/" title="BlackSheep" class="md-header__button md-logo" aria-label="BlackSheep" data-md-component="logo">
      
  <img src="/blacksheep/img/logow.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BlackSheep
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Authorization
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Neoteroi/BlackSheep" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Neoteroi/BlackSheep
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="/blacksheep/" title="BlackSheep" class="md-nav__button md-logo" aria-label="BlackSheep" data-md-component="logo">
      
  <img src="/blacksheep/img/logow.svg" alt="logo">

    </a>
    BlackSheep
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Neoteroi/BlackSheep" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Neoteroi/BlackSheep
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/" class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/getting-started/" class="md-nav__link">
        Getting started: basics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/mvc-project-template/" class="md-nav__link">
        Getting started: MVC
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/dependency-injection/" class="md-nav__link">
        Dependency injection
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/openapi/" class="md-nav__link">
        OpenAPI Docs
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/application/" class="md-nav__link">
        Application
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/routing/" class="md-nav__link">
        Routing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/request-handlers/" class="md-nav__link">
        Request handlers
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/requests/" class="md-nav__link">
        Requests
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/responses/" class="md-nav__link">
        Responses
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/testing/" class="md-nav__link">
        Testing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/templating/" class="md-nav__link">
        Templating
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/controllers/" class="md-nav__link">
        Controllers
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/middlewares/" class="md-nav__link">
        Middlewares
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/static-files/" class="md-nav__link">
        Serving static files
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/websocket/" class="md-nav__link">
        WebSocket
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/server-sent-events/" class="md-nav__link">
        Server-sent events
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/authentication/" class="md-nav__link">
        Authentication
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Authorization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Authorization
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-to-use-built-in-authorization" class="md-nav__link">
    How to use built-in authorization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-an-authorization-policy-that-checks-a-users-claims" class="md-nav__link">
    Defining an authorization policy that checks a user's claims
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-default-policy" class="md-nav__link">
    Using the default policy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#specifying-authentication-schemes-for-request-handlers" class="md-nav__link">
    Specifying authentication schemes for request handlers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#failure-response-codes" class="md-nav__link">
    Failure response codes
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/openid-connect/" class="md-nav__link">
        OpenID Connect
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/sessions/" class="md-nav__link">
        Sessions
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_22" >
      
      
      
        <label class="md-nav__link" for="__nav_22" id="__nav_22_label" tabindex="0">
          Security
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_22_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_22">
          <span class="md-nav__icon md-icon"></span>
          Security
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/cors/" class="md-nav__link">
        CORS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/anti-request-forgery/" class="md-nav__link">
        Anti-Forgery
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/dataprotection/" class="md-nav__link">
        Data protection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/hsts/" class="md-nav__link">
        HSTS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/remotes/" class="md-nav__link">
        Remotes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_23" >
      
      
      
        <label class="md-nav__link" for="__nav_23" id="__nav_23_label" tabindex="0">
          Response features
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_23_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_23">
          <span class="md-nav__icon md-icon"></span>
          Response features
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/cache-control/" class="md-nav__link">
        Cache control
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/compression/" class="md-nav__link">
        Compression
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_24" >
      
      
      
        <label class="md-nav__link" for="__nav_24" id="__nav_24_label" tabindex="0">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_24_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_24">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/examples/marshmallow/" class="md-nav__link">
        Using Marshmallow
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/settings/" class="md-nav__link">
        Settings
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/binders/" class="md-nav__link">
        Binders
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/background-tasks/" class="md-nav__link">
        Background tasks
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/mounting/" class="md-nav__link">
        Mounting apps
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/client/" class="md-nav__link">
        HTTP Client
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/cli/" class="md-nav__link">
        More about the CLI
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/versions/migrating-to-v2/" class="md-nav__link">
        From V1 to V2
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/develop-with-https/" class="md-nav__link">
        Develop using HTTPS
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/asgi/" class="md-nav__link">
        ASGI
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/extensions/" class="md-nav__link">
        Extensions
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/blacksheep/about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="/" class="md-nav__link">
        Neoteroi docs home
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-to-use-built-in-authorization" class="md-nav__link">
    How to use built-in authorization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-an-authorization-policy-that-checks-a-users-claims" class="md-nav__link">
    Defining an authorization policy that checks a user's claims
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-default-policy" class="md-nav__link">
    Using the default policy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#specifying-authentication-schemes-for-request-handlers" class="md-nav__link">
    Specifying authentication schemes for request handlers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#failure-response-codes" class="md-nav__link">
    Failure response codes
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                

  
                  


<h1 id="authorization-in-blacksheep">Authorization in BlackSheep<a class="headerlink" href="#authorization-in-blacksheep" title="Permanent link">&para;</a></h1>
<p>The words "authorization strategy" in the context of a web application refer to
the ability to determine whether the user is allowed to do certain operations.
BlackSheep implements a built-in authorization strategy for request handlers.
This page describes:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> How to use the built-in authorization strategy.</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> How to apply authorization rules to request handlers.</li>
</ul>
<p>It is recommended to read about <a href="/blacksheep/authentication">authentication</a> before
reading this page.</p>
<h2 id="how-to-use-built-in-authorization">How to use built-in authorization<a class="headerlink" href="#how-to-use-built-in-authorization" title="Permanent link">&para;</a></h2>
<p>Examples of common strategies to authorize users in web applications include:</p>
<ul>
<li>verifying that the user's context obtained from a <a href="https://jwt.io/introduction/">JWT includes certain
  claims</a> (e.g. <code>scope</code>, <code>role</code>)</li>
<li>verifying that a web request includes a certain key, like an instrumentation
  key or a key signed by a private RSA key (owned by the user) that can be
  verified by a public RSA key (used by the server to validate)</li>
</ul>
<p>The example below shows how to configure an authorization handler that
requires an authenticated user. It is modified from the example in the
<a href="/blacksheep/authentication">authentication</a> page:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span> <span class="nn">blacksheep</span> <span class="kn">import</span> <span class="n">Application</span><span class="p">,</span> <span class="n">Request</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">ok</span><span class="p">,</span> <span class="n">get</span>
<span class="kn">from</span> <span class="nn">blacksheep.server.authorization</span> <span class="kn">import</span> <span class="n">Policy</span><span class="p">,</span> <span class="n">auth</span>
<span class="kn">from</span> <span class="nn">guardpost.asynchronous.authentication</span> <span class="kn">import</span> <span class="n">AuthenticationHandler</span><span class="p">,</span> <span class="n">Identity</span>
<span class="kn">from</span> <span class="nn">guardpost.authentication</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">guardpost.common</span> <span class="kn">import</span> <span class="n">AuthenticatedRequirement</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Application</span><span class="p">(</span><span class="n">show_error_details</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ExampleAuthHandler</span><span class="p">(</span><span class="n">AuthenticationHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Identity</span><span class="p">]:</span>
        <span class="n">header_value</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get_first_header</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Authorization&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">header_value</span><span class="p">:</span>
            <span class="c1"># TODO: parse and validate the value of the authorization</span>
            <span class="c1"># header to get an actual user&#39;s identity</span>
            <span class="n">context</span><span class="o">.</span><span class="n">identity</span> <span class="o">=</span> <span class="n">Identity</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Jan Kowalski&quot;</span><span class="p">},</span> <span class="s2">&quot;MOCK&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">context</span><span class="o">.</span><span class="n">identity</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">identity</span>


<span class="n">app</span><span class="o">.</span><span class="n">use_authentication</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ExampleAuthHandler</span><span class="p">())</span>

<span class="n">Authenticated</span> <span class="o">=</span> <span class="s2">&quot;authenticated&quot;</span>

<span class="c1"># enable authorization, and add a policy that requires an authenticated user</span>
<span class="n">app</span><span class="o">.</span><span class="n">use_authorization</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Policy</span><span class="p">(</span><span class="n">Authenticated</span><span class="p">,</span> <span class="n">AuthenticatedRequirement</span><span class="p">()))</span>


<span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">for_anybody</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">User</span><span class="p">]):</span>
    <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="p">({</span><span class="s2">&quot;anonymous&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">json</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">claims</span><span class="p">)</span>


<span class="nd">@auth</span><span class="p">(</span><span class="n">Authenticated</span><span class="p">)</span>
<span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;/account&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">only_for_authenticated_users</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">ok</span><span class="p">(</span><span class="s2">&quot;example&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Note:</p>
<ul>
<li>authorization is enabled using <code>app.use_authorization()</code></li>
<li>this method returns an instance of <code>AuthorizationStrategy</code>, which handles
  the authorization rules</li>
<li>the method <code>.add(Policy(Authenticated, AuthenticatedRequirement()))</code>
  configures an authorization policy with a single requirement, to have an
  authenticated user</li>
<li>the authorization policy is applied to request handlers using the <code>@auth</code>
  decorator from <code>blacksheep.server.authorization</code> with an argument that
  specifies the policy to be used</li>
</ul>
<p>It is possible to define several authorization policies, each specifying one
or more requirements to be satisfied in order for authorization to succeed.
The next example explains how to configure an authorization policy that checks
for user's roles from claims.</p>
<h2 id="defining-an-authorization-policy-that-checks-a-users-claims">Defining an authorization policy that checks a user's claims<a class="headerlink" href="#defining-an-authorization-policy-that-checks-a-users-claims" title="Permanent link">&para;</a></h2>
<p>The example below shows how to configure an authorization handler that
validates a user's claims (looking for a "role" claim that might be coming from
a JWT).</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">blacksheep.server.authorization</span> <span class="kn">import</span> <span class="n">Policy</span>

<span class="kn">from</span> <span class="nn">guardpost.authorization</span> <span class="kn">import</span> <span class="n">AuthorizationContext</span>
<span class="kn">from</span> <span class="nn">guardpost.authorization</span> <span class="kn">import</span> <span class="n">Requirement</span>


<span class="k">class</span> <span class="nc">AdminRequirement</span><span class="p">(</span><span class="n">Requirement</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">AuthorizationContext</span><span class="p">):</span>
        <span class="n">identity</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">identity</span>

        <span class="k">if</span> <span class="n">identity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">identity</span><span class="o">.</span><span class="n">claims</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;role&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;admin&quot;</span><span class="p">:</span>
            <span class="n">context</span><span class="o">.</span><span class="n">succeed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">AdminsPolicy</span><span class="p">(</span><span class="n">Policy</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="n">AdminRequirement</span><span class="p">())</span>
</code></pre></div>
<p>Full example:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span> <span class="nn">blacksheep</span> <span class="kn">import</span> <span class="n">Application</span><span class="p">,</span> <span class="n">Request</span><span class="p">,</span> <span class="n">get</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">ok</span>
<span class="kn">from</span> <span class="nn">blacksheep.server.authorization</span> <span class="kn">import</span> <span class="n">Policy</span><span class="p">,</span> <span class="n">auth</span>
<span class="kn">from</span> <span class="nn">guardpost</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">AuthenticationHandler</span><span class="p">,</span>
    <span class="n">Identity</span><span class="p">,</span>
    <span class="n">User</span><span class="p">,</span>
    <span class="n">AuthorizationContext</span><span class="p">,</span>
    <span class="n">Requirement</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">guardpost.common</span> <span class="kn">import</span> <span class="n">AuthenticatedRequirement</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Application</span><span class="p">(</span><span class="n">show_error_details</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ExampleAuthHandler</span><span class="p">(</span><span class="n">AuthenticationHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Identity</span><span class="p">]:</span>
        <span class="n">header_value</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get_first_header</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Authorization&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">header_value</span><span class="p">:</span>
            <span class="c1"># TODO: parse and validate the value of the authorization</span>
            <span class="c1"># header to get an actual user&#39;s identity</span>
            <span class="n">context</span><span class="o">.</span><span class="n">identity</span> <span class="o">=</span> <span class="n">Identity</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Jan Kowalski&quot;</span><span class="p">},</span> <span class="s2">&quot;MOCK&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">context</span><span class="o">.</span><span class="n">identity</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">identity</span>


<span class="n">app</span><span class="o">.</span><span class="n">use_authentication</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ExampleAuthHandler</span><span class="p">())</span>

<span class="n">Authenticated</span> <span class="o">=</span> <span class="s2">&quot;authenticated&quot;</span>


<span class="k">class</span> <span class="nc">AdminRequirement</span><span class="p">(</span><span class="n">Requirement</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">AuthorizationContext</span><span class="p">):</span>
        <span class="n">identity</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">identity</span>

        <span class="k">if</span> <span class="n">identity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">identity</span><span class="o">.</span><span class="n">claims</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;role&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;admin&quot;</span><span class="p">:</span>
            <span class="n">context</span><span class="o">.</span><span class="n">succeed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">AdminPolicy</span><span class="p">(</span><span class="n">Policy</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="n">AdminRequirement</span><span class="p">())</span>


<span class="n">app</span><span class="o">.</span><span class="n">use_authorization</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Policy</span><span class="p">(</span><span class="n">Authenticated</span><span class="p">,</span> <span class="n">AuthenticatedRequirement</span><span class="p">()))</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">AdminPolicy</span><span class="p">()</span>
<span class="p">)</span>


<span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">for_anybody</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">User</span><span class="p">]):</span>
    <span class="c1"># This method can be used by anybody</span>
    <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="p">({</span><span class="s2">&quot;anonymous&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">json</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">claims</span><span class="p">)</span>


<span class="nd">@auth</span><span class="p">(</span><span class="n">Authenticated</span><span class="p">)</span>
<span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;/account&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">only_for_authenticated_users</span><span class="p">():</span>
    <span class="c1"># This method can be used by any authenticated user</span>
    <span class="k">return</span> <span class="n">ok</span><span class="p">(</span><span class="s2">&quot;example&quot;</span><span class="p">)</span>


<span class="nd">@auth</span><span class="p">(</span><span class="s2">&quot;admin&quot;</span><span class="p">)</span>
<span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;/admin&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">only_for_administrators</span><span class="p">():</span>
    <span class="c1"># This method requires &quot;admin&quot; role in user&#39;s claims</span>
    <span class="k">return</span> <span class="n">ok</span><span class="p">(</span><span class="s2">&quot;example&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="using-the-default-policy">Using the default policy<a class="headerlink" href="#using-the-default-policy" title="Permanent link">&para;</a></h2>
<p>The method <code>app.use_authorization()</code>, when used without arguments, returns an
instance of <code>AuthorizationStrategy</code> from the <code>guardpost</code> library. This object
can be configured to use a default policy, for example to require an
authenticated user by default for all request handlers.</p>
<div class="highlight"><pre><span></span><code><span class="n">authorization</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">use_authorization</span><span class="p">()</span>

<span class="c1"># configure a default policy to require an authenticated user for all handlers</span>
<span class="n">authorization</span><span class="o">.</span><span class="n">default_policy</span> <span class="o">=</span> <span class="n">Policy</span><span class="p">(</span><span class="s2">&quot;authenticated&quot;</span><span class="p">,</span> <span class="n">AuthenticatedRequirement</span><span class="p">())</span>
</code></pre></div>
<p>The default policy is used when the <code>@auth</code> decorator is used without arguments.</p>
<p>To enable anonymous access for certain handlers in this scenario, use the
<code>allow_anonymous</code> decorator from <code>blacksheep.server.authorization</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">blacksheep.server.authorization</span> <span class="kn">import</span> <span class="n">allow_anonymous</span>


<span class="nd">@allow_anonymous</span><span class="p">()</span>
<span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">for_anybody</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">User</span><span class="p">]):</span>
    <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="p">({</span><span class="s2">&quot;anonymous&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">json</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">claims</span><span class="p">)</span>
</code></pre></div>
<h2 id="specifying-authentication-schemes-for-request-handlers">Specifying authentication schemes for request handlers<a class="headerlink" href="#specifying-authentication-schemes-for-request-handlers" title="Permanent link">&para;</a></h2>
<p>In some scenarios it is necessary to specify multiple authentication schemes
for web applications: for example, the same application might handle
authentication obtained through the <code>GitHub</code> OAuth app and <code>Azure Active
Directory (AAD)</code>. In such scenarios, it might be necessary to restrict access
to some endpoints by authentication method, too.</p>
<p>To do so:</p>
<ol>
<li>specify different authentication handlers, configuring schemes overriding
   the <code>scheme</code> property as in the example below.</li>
<li>use the <code>authentication_schemes</code> parameter in the <code>@auth</code> decorator</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">GitHubAuthHandler</span><span class="p">(</span><span class="n">AuthenticationHandler</span><span class="p">):</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">scheme</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
      <span class="k">return</span> <span class="s2">&quot;github&quot;</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Identity</span><span class="p">]:</span>
        <span class="o">...</span>


<span class="nd">@auth</span><span class="p">(</span><span class="s2">&quot;authenticated&quot;</span><span class="p">,</span> <span class="n">authentication_schemes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;github&quot;</span><span class="p">])</span>
<span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;/admin&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">only_for_user_authenticated_with_github</span><span class="p">():</span>
    <span class="c1"># This method only tries to authenticate users using the &quot;github&quot;</span>
    <span class="c1"># authentication scheme, defined overriding the scheme @property</span>
    <span class="k">return</span> <span class="n">ok</span><span class="p">(</span><span class="s2">&quot;example&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="failure-response-codes">Failure response codes<a class="headerlink" href="#failure-response-codes" title="Permanent link">&para;</a></h2>
<p>When a request fails because of authorization reasons, the web framework
returns:</p>
<ul>
<li>status <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401"><code>401 Unauthorized</code></a> if authentication failed, and no valid credentials were provided</li>
<li>status <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/403"><code>403 Forbidden</code></a> if
  authentication succeeded as valid credentials were provided, but the user is
  not authorized to perform an action</li>
</ul>
<div class="nt-contribs"><p class="nt-mod-time">Last modified on: 2023-12-18 17:52:09</p><div class="nt-contributors"><div class="nt-contributor image nt-group-0" title="Roberto Prevato &lt;roberto.prevato@gmail.com&gt; (4)" style="background-image: url('https://avatars.githubusercontent.com/u/2576032?s=400&amp;u=d8d880e8ed05bb170877dd3d561d8301c4beeeed&amp;v=4')"><span class="nt-initials" /></div><div class="nt-contributor nt-group-1" title="Elliot Waite &lt;elliot@elliotwaite.com&gt; (1)"><span class="nt-initials">EW</span></div><div class="nt-contributor nt-group-2" title="Roman Vlasenko &lt;56698047+Klavionik@users.noreply.github.com&gt; (1)"><span class="nt-initials">RV</span></div></div></div>





<!-- Giscus snippet -->
<script src="https://giscus.app/client.js"
    data-repo="Neoteroi/BlackSheep-Docs"
    data-repo-id="MDEwOlJlcG9zaXRvcnkzNzYyOTM4ODI="
    data-category="Q&A"
    data-category-id="DIC_kwDOFm3J-s4CSpF8"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="bottom"
    data-theme="dark_tritanopia"
    data-lang="en"
    data-loading="lazy"
    crossorigin="anonymous"
    async>
</script>

<!-- Synchronize Giscus theme with palette -->
<script>
  var giscus = document.querySelector("script[src*=giscus]")

  /* Set palette on initial load */
  var palette = __md_get("__palette")
  if (palette && typeof palette.color === "object") {
    var theme = palette.color.scheme === "slate" ? "dark" : "light"
    giscus.setAttribute("data-theme", theme)
  }

  /* Register event handlers after documented loaded */
  document.addEventListener("DOMContentLoaded", function() {
    var ref = document.querySelector("[data-md-component=palette]")
    ref.addEventListener("change", function() {
      var palette = __md_get("__palette")
      if (palette && typeof palette.color === "object") {
        var theme = palette.color.scheme === "slate" ? "dark" : "light"

        /* Instruct Giscus to change theme */
        var frame = document.querySelector(".giscus-frame")
        frame.contentWindow.postMessage(
          { giscus: { setConfig: { theme } } },
          "https://giscus.app"
        )
      }
    })
  })
</script>

                

              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="/blacksheep/authentication/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Authentication" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Authentication
              </div>
            </div>
          </a>
        
        
          
          <a href="/blacksheep/openid-connect/" class="md-footer__link md-footer__link--next" aria-label="Next: OpenID Connect" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                OpenID Connect
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.footer", "content.code.copy", "content.action.view"], "search": "../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": 2}</script>
    
    
      <script src="/blacksheep/assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>