
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="The official documentation website of BlackSheep, a fast ASGI web framework for Python asyncio.">
      
      
        <meta name="author" content="Roberto Prevato">
      
      
        <link rel="canonical" href="https://www.neoteroi.dev/blacksheep/openid-connect/">
      
      
        <link rel="prev" href="../authorization/">
      
      
        <link rel="next" href="../sessions/">
      
      
      <link rel="icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>OpenID Connect - BlackSheep</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/neoteroi.css">
    
      <link rel="stylesheet" href="../css/extra.css?v=20221120">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-T65MX5XNF2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-T65MX5XNF2');
</script>

    
    
  
  
    
  
  
  <meta property="og:type" content="website">
  <meta property="og:title" content="BlackSheep - OpenID Connect">
  <meta property="og:description" content="The official documentation website of BlackSheep, a fast ASGI web framework for Python asyncio.">
  <meta property="og:url" content="https://www.neoteroi.dev/blacksheep/openid-connect/">
  <meta property="og:image" content="https://www.neoteroi.dev/blacksheep/img/banner.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:image:width" content="1080">
  <meta property="og:image:height" content="568">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@RobertoPrevato">
  <meta name="twitter:creator" content="@RobertoPrevato">
  <meta name="twitter:title" content="BlackSheep - OpenID Connect">
  <meta name="twitter:description" content="The official documentation website of BlackSheep, a fast ASGI web framework for Python asyncio.">
  <meta name="twitter:image" content="https://www.neoteroi.dev/blacksheep/img/banner.png">
  <script>
    (function () {
        var fullscreen = localStorage.getItem("FULLSCREEN") || "N";
        if (fullscreen === "Y") {
            document.documentElement.classList.add("fullscreen");
        }
    })();
  </script>

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#openid-connect" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="BlackSheep" class="md-header__button md-logo" aria-label="BlackSheep" data-md-component="logo">
      
  <img src="../img/logow.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BlackSheep
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              OpenID Connect
            
          </span>
        </div>
      </div>
    </div>
    <form id="fullscreen-form" class="md-header__option" data-md-component="fullscreen">
      <input class="md-option" aria-label="Enter full screen" type="radio" name="__fullscreen" id="__fullscreen">
      <label title="Full screen" class="md-header__button md-icon" id="full-screen" for="__fullscreen">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 5h5v2H7v3H5zm9 0h5v5h-2V7h-3zm3 9h2v5h-5v-2h3zm-7 3v2H5v-5h2v3z"/></svg>
      </label>
      <input class="md-option" aria-label="Exit full screen" type="radio" name="__fullscreen" id="__fullscreen_no">
      <label title="Exit full screen" class="md-header__button md-icon" id="full-screen-exit" for="__fullscreen_no">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14 14h5v2h-3v3h-2zm-9 0h5v5H8v-3H5zm3-9h2v5H5V8h3zm11 3v2h-5V5h2v3z"/></svg>
      </label>
    </form>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Neoteroi/BlackSheep" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Neoteroi/BlackSheep
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="BlackSheep" class="md-nav__button md-logo" aria-label="BlackSheep" data-md-component="logo">
      
  <img src="../img/logow.svg" alt="logo">

    </a>
    BlackSheep
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Neoteroi/BlackSheep" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Neoteroi/BlackSheep
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting started: basics
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../mvc-project-template/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting started: MVC
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dependency-injection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dependency injection
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../openapi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenAPI Docs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../application/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Application
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../routing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Routing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../request-handlers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Request handlers
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../requests/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Requests
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Responses
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../templating/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Templating
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../controllers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Controllers
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../middlewares/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Middlewares
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../static-files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Serving static files
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../websocket/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WebSocket
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../server-sent-events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Server-sent events
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../authorization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authorization
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    OpenID Connect
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    OpenID Connect
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basic-example" class="md-nav__link">
    <span class="md-ellipsis">
      Basic example
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use_openid_connect" class="md-nav__link">
    <span class="md-ellipsis">
      use_openid_connect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openidsettings" class="md-nav__link">
    <span class="md-ellipsis">
      OpenIDSettings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples-using-custom-scopes" class="md-nav__link">
    <span class="md-ellipsis">
      Examples using custom scopes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#events" class="md-nav__link">
    <span class="md-ellipsis">
      Events
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storing-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Storing tokens
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-references" class="md-nav__link">
    <span class="md-ellipsis">
      Useful references
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-tokens-are-protected" class="md-nav__link">
    <span class="md-ellipsis">
      How tokens are protected
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sessions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sessions
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_22" >
        
          
          <label class="md-nav__link" for="__nav_22" id="__nav_22_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Security
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_22_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_22">
            <span class="md-nav__icon md-icon"></span>
            Security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CORS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../anti-request-forgery/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Anti-Forgery
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataprotection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data protection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hsts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HSTS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../remotes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Remotes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_23" >
        
          
          <label class="md-nav__link" for="__nav_23" id="__nav_23_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Response features
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_23_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_23">
            <span class="md-nav__icon md-icon"></span>
            Response features
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cache-control/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cache control
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compression/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Compression
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_24" >
        
          
          <label class="md-nav__link" for="__nav_24" id="__nav_24_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_24_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_24">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/marshmallow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Marshmallow
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_25" >
        
          
          <label class="md-nav__link" for="__nav_25" id="__nav_25_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Production deployments
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_25_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_25">
            <span class="md-nav__icon md-icon"></span>
            Production deployments
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../behind-proxies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Behind proxies
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Settings
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../binders/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Binders
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../background-tasks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Background tasks
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../mounting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mounting apps
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../client/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTTP Client
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    More about the CLI
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../versions/migrating-to-v2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    From V1 to V2
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../develop-with-https/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Develop using HTTPS
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../asgi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ASGI
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../extensions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extensions
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Neoteroi docs home
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basic-example" class="md-nav__link">
    <span class="md-ellipsis">
      Basic example
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use_openid_connect" class="md-nav__link">
    <span class="md-ellipsis">
      use_openid_connect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openidsettings" class="md-nav__link">
    <span class="md-ellipsis">
      OpenIDSettings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples-using-custom-scopes" class="md-nav__link">
    <span class="md-ellipsis">
      Examples using custom scopes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#events" class="md-nav__link">
    <span class="md-ellipsis">
      Events
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storing-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Storing tokens
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-references" class="md-nav__link">
    <span class="md-ellipsis">
      Useful references
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-tokens-are-protected" class="md-nav__link">
    <span class="md-ellipsis">
      How tokens are protected
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                

  
                  


<h1 id="openid-connect">OpenID Connect<a class="headerlink" href="#openid-connect" title="Permanent link">&para;</a></h1>
<p>BlackSheep implements built-in support for OpenID Connect authentication,
meaning that it can be easily integrated with identity provider services such
as:</p>
<ul>
<li><a href="https://auth0.com">Auth0</a></li>
<li><a href="https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id">Entra ID</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/active-directory-b2c/overview">Azure Active Directory B2C</a></li>
<li><a href="https://www.okta.com">Okta</a></li>
</ul>
<p>This page documents:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> How to use OpenID Connect integration to provide sign-in and sign-up features,
  and to identify users who use the application</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> How to use OpenID Connect integration to obtain <code>access_token</code>s to use APIs
  (in addition, or instead of <code>id_token</code>s)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> How tokens are protected and how to configure applications to support
  multiple instances and regions</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Using JWT Bearer and OpenID integrations requires more dependencies: use
<code>pip install blacksheep[full]</code> to use these features</p>
</div>
<h2 id="basic-example">Basic example<a class="headerlink" href="#basic-example" title="Permanent link">&para;</a></h2>
<p>A basic example with any of the identity providers listed above, having
implicit flow enabled for <code>id_token</code>, looks like the following:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">blacksheep</span><span class="w"> </span><span class="kn">import</span> <span class="n">Application</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">pretty_json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">blacksheep.server.authentication.oidc</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenIDSettings</span><span class="p">,</span> <span class="n">use_openid_connect</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">guardpost.authentication</span><span class="w"> </span><span class="kn">import</span> <span class="n">Identity</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Application</span><span class="p">()</span>


<span class="n">use_openid_connect</span><span class="p">(</span>
    <span class="n">app</span><span class="p">,</span>
    <span class="n">OpenIDSettings</span><span class="p">(</span>
        <span class="n">authority</span><span class="o">=</span><span class="s2">&quot;&lt;YOUR_AUTHORITY&gt;&quot;</span><span class="p">,</span>
        <span class="n">client_id</span><span class="o">=</span><span class="s2">&quot;&lt;CLIENT_ID&gt;&quot;</span><span class="p">,</span>
        <span class="n">callback_path</span><span class="o">=</span><span class="s2">&quot;&lt;CALLBACK_PATH&gt;&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>


<span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">home</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="n">Identity</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">pretty_json</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">claims</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span>

    <span class="k">return</span> <span class="n">html</span><span class="p">(</span><span class="s2">&quot;&lt;a href=&#39;/sign-in&#39;&gt;Sign in&lt;/a&gt;&lt;br/&gt;&quot;</span><span class="p">)</span>
</code></pre></div>
<p>When the application is configured with <code>use_openid_connect</code>, request handlers
are automatically configured to handle users' sign-in, the redirect after a
user signs-in, and signs-out. After a user signs-in successfully, a signed and
encrypted cookie containing the claims of the <code>id_token</code> is set automatically
for the client, having an expiration time matching the expiration time of the
<code>id_token</code> itself. User's identity is automatically restored at each web
request by an authentication middleware, and can be read as in the provided
examples:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">home</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="n">Identity</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
        <span class="o">...</span>
</code></pre></div>
<h3 id="use_openid_connect">use_openid_connect<a class="headerlink" href="#use_openid_connect" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type, default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>app</td>
<td>Application</td>
<td>Instance of BlackSheep application.</td>
</tr>
<tr>
<td>settings</td>
<td>OpenIDSettings</td>
<td>Instance of OpenIDSettings.</td>
</tr>
<tr>
<td>auth_handler</td>
<td>Optional[OpenIDTokensHandler] = None (CookiesOpenIDTokensHandler)</td>
<td>Instance of OpenIDTokensHandler that can handle tokens for requests and responses for the OpenID Connect flow. This class is responsible for communicating tokens to clients, and restoring tokens context for following requests.</td>
</tr>
<tr>
<td>parameters_builder</td>
<td>Optional[ParametersBuilder] = None</td>
<td>Optional instance of <code>ParametersBuilder</code>, used to handle parameters configured in redirects and requests to the authorization server.</td>
</tr>
<tr>
<td>is_default</td>
<td>bool = True</td>
<td>If default, clients are automatically redirected to the <code>sign-in</code> page when a non-authenticated user tries to access in <code>GET</code> a web page that requires authentication.</td>
</tr>
</tbody>
</table>
<h3 id="openidsettings">OpenIDSettings<a class="headerlink" href="#openidsettings" title="Permanent link">&para;</a></h3>
<p>The <code>OpenIDSettings</code> class has the following properties:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type, default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>client_id</td>
<td>str</td>
<td>ID of the application in the identity server.</td>
</tr>
<tr>
<td>authority</td>
<td>Optional[str] = None</td>
<td>If specified, URL of the authorization server.</td>
</tr>
<tr>
<td>audience</td>
<td>Optional[str] = None</td>
<td>If specified, the <code>audience</code> for requests using scopes to an API (<a href="https://auth0.com/docs/configure/apis/scopes/sample-use-cases-scopes-and-claims#request-custom-api-access">ref.</a>).</td>
</tr>
<tr>
<td>client_secret</td>
<td>Optional[str] = None</td>
<td>For requests that use <code>Authorization Code Grant</code> flow, the secret of the client application in the identity server.</td>
</tr>
<tr>
<td>discovery_endpoint</td>
<td>Optional[str] = None</td>
<td>If specified, the exact URL to the discovery point (useful with Okta when using custom scopes for an authorization server).</td>
</tr>
<tr>
<td>entry_path</td>
<td>str = "/sign-in"</td>
<td>The local entry path for sign-in (this redirects to the sign-in page of the identity server).</td>
</tr>
<tr>
<td>logout_path</td>
<td>str = "/sign-out"</td>
<td>The local path to the sign-out endpoint (this removes authentication cookie).</td>
</tr>
<tr>
<td>post_logout_redirect_path</td>
<td>str = "/"</td>
<td>The local path to which a user is redirected after signing-out.</td>
</tr>
<tr>
<td>callback_path</td>
<td>str = "/authorization-callback"</td>
<td>The local path to handle the redirect after a user signs-in (the reply_url in the identity server must be configured accordingly).</td>
</tr>
<tr>
<td>refresh_token_path</td>
<td>str = "/refresh-token"</td>
<td>The local path used to handle refresh tokens to obtain new tokens.</td>
</tr>
<tr>
<td>scope</td>
<td>str = "openid profile email"</td>
<td>The scope of the request, by default an <code>id_token</code> is obtained with email and profile.</td>
</tr>
<tr>
<td>response_type</td>
<td>str = "code"</td>
<td>Type of OAuth response.</td>
</tr>
<tr>
<td>redirect_uri</td>
<td>Optional[str] = None</td>
<td>If specified, the redirect URL that must match the one configured for the application. If not provided, a redirect_url is obtained automatically (see note 🗡️).</td>
</tr>
<tr>
<td>scheme_name</td>
<td>str = "OpenIDConnect"</td>
<td>The name of the authentication scheme, affecting the name of authentication cookies (see note 🍒).</td>
</tr>
<tr>
<td>error_redirect_path</td>
<td>Optional[str] = None</td>
<td>If specified, the local path to which a user is redirected in case of error.</td>
</tr>
<tr>
<td>end_session_endpoint</td>
<td>Optional[str] = None</td>
<td>If specified, the local path to which the user can log out.</td>
</tr>
</tbody>
</table>
<p>Notes:</p>
<ul>
<li>🗡️ obtaining a redirect_url automatically can require handling of forward
  headers, when an application is deployed behind a proxy. See
  <a href="../remotes">remotes for more information</a>.</li>
<li>🍒 this should be changed when configuring more than one OIDC identity
  provider.</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p><code>access_token</code>s issued for APIs can be validated using
<a href="../authentication/#jwt-bearer">JWT Bearer authentication</a></p>
</div>
<h2 id="examples-using-custom-scopes">Examples using custom scopes<a class="headerlink" href="#examples-using-custom-scopes" title="Permanent link">&para;</a></h2>
<p>An integration with an <code>Auth0</code> application that uses custom scopes, where the
application obtains both an <code>id_token</code> and an <code>access_token</code> for an API,
looks like the following:</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This example shows how to configure an OpenID Connect integration with Auth0, obtaining</span>
<span class="sd">an id_token, an access_token, and a refresh_token. The id_token is exchanged with the</span>
<span class="sd">client using a response cookie (also used to authenticate users</span>
<span class="sd">for following requests), while the access token and the refresh token are not stored</span>
<span class="sd">and can only be accessed using optional events.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">uvicorn</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">blacksheep.server.application</span><span class="w"> </span><span class="kn">import</span> <span class="n">Application</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">blacksheep.server.authentication.oidc</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenIDSettings</span><span class="p">,</span> <span class="n">use_openid_connect</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dotenv</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_dotenv</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">common.routes</span><span class="w"> </span><span class="kn">import</span> <span class="n">register_routes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">common.secrets</span><span class="w"> </span><span class="kn">import</span> <span class="n">Secrets</span>

<span class="n">load_dotenv</span><span class="p">()</span>
<span class="n">secrets</span> <span class="o">=</span> <span class="n">Secrets</span><span class="o">.</span><span class="n">from_env</span><span class="p">()</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Application</span><span class="p">(</span><span class="n">show_error_details</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="c1"># Auth0 with a custom scope</span>
<span class="n">use_openid_connect</span><span class="p">(</span>
    <span class="n">app</span><span class="p">,</span>
    <span class="n">OpenIDSettings</span><span class="p">(</span>
        <span class="n">authority</span><span class="o">=</span><span class="s2">&quot;https://neoteroi.eu.auth0.com&quot;</span><span class="p">,</span>
        <span class="n">audience</span><span class="o">=</span><span class="s2">&quot;http://localhost:5000/api/todos&quot;</span><span class="p">,</span>
        <span class="n">client_id</span><span class="o">=</span><span class="s2">&quot;OOGPl4dgG7qKsm2IOWq72QhXV4wsLhbQ&quot;</span><span class="p">,</span>
        <span class="n">client_secret</span><span class="o">=</span><span class="n">secrets</span><span class="o">.</span><span class="n">auth0_client_secret</span><span class="p">,</span>
        <span class="n">callback_path</span><span class="o">=</span><span class="s2">&quot;/signin-oidc&quot;</span><span class="p">,</span>
        <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;openid profile read:todos&quot;</span><span class="p">,</span>
        <span class="n">error_redirect_path</span><span class="o">=</span><span class="s2">&quot;/sign-in-error&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="n">register_routes</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>
</code></pre></div>
<p>An integration with <code>Entra ID</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">handler</span> <span class="o">=</span> <span class="n">use_openid_connect</span><span class="p">(</span>
    <span class="n">app</span><span class="p">,</span>
    <span class="n">OpenIDSettings</span><span class="p">(</span>
        <span class="n">authority</span><span class="o">=</span><span class="s2">&quot;https://login.microsoftonline.com/b62b317a-19c2-40c0-8650-2d9672324ac4/v2.0/&quot;</span><span class="p">,</span>
        <span class="n">client_id</span><span class="o">=</span><span class="s2">&quot;499adb65-5e26-459e-bc35-b3e1b5f71a9d&quot;</span><span class="p">,</span>
        <span class="n">client_secret</span><span class="o">=</span><span class="n">secrets</span><span class="o">.</span><span class="n">aad_client_secret</span><span class="p">,</span>
        <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;openid profile offline_access email &quot;</span>
        <span class="s2">&quot;api://65d21481-4f1a-4731-9508-ad965cb4d59f/example&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<p>An integration with <code>Okta</code>, using the <code>default</code> authorization server:</p>
<div class="highlight"><pre><span></span><code><span class="n">use_openid_connect</span><span class="p">(</span>
    <span class="n">app</span><span class="p">,</span>
    <span class="n">OpenIDSettings</span><span class="p">(</span>
        <span class="n">discovery_endpoint</span><span class="o">=</span><span class="s2">&quot;https://dev-34685660.okta.com/oauth2/default/.well-known/oauth-authorization-server&quot;</span><span class="p">,</span>
        <span class="n">client_id</span><span class="o">=</span><span class="s2">&quot;0oa2gy88qiVyuOClI5d7&quot;</span><span class="p">,</span>
        <span class="n">client_secret</span><span class="o">=</span><span class="n">secrets</span><span class="o">.</span><span class="n">okta_client_secret</span><span class="p">,</span>
        <span class="n">callback_path</span><span class="o">=</span><span class="s2">&quot;/authorization-code/callback&quot;</span><span class="p">,</span>
        <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;openid read:todos&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<h2 id="events">Events<a class="headerlink" href="#events" title="Permanent link">&para;</a></h2>
<p>The API exposes the following events:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">blacksheep.server.authentication.oidc</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">OpenIDSettings</span><span class="p">,</span>
    <span class="n">TokenResponse</span><span class="p">,</span>
    <span class="n">use_openid_connect</span>
<span class="p">)</span>


<span class="n">oidc</span> <span class="o">=</span> <span class="n">use_openid_connect</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>


<span class="nd">@oidc</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">on_id_token_validated</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">id_token_callback</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">id_token_claims</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This callback is called after an id_token is received, successfully</span>
<span class="sd">    verified using public RSA keys from the identity provider, and parsed</span>

<span class="sd">    Using this event handler is possible to modify the claims obtained from the</span>
<span class="sd">    id_token before they are set in the authentication cookie. For example to</span>
<span class="sd">    remove certain claims, or add other information.</span>
<span class="sd">    &quot;&quot;&quot;</span>


<span class="nd">@oidc</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">on_tokens_received</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">on_tokens_received</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">token_response</span><span class="p">:</span> <span class="n">TokenResponse</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This callback is called after a successful web request to the token</span>
<span class="sd">    endpoint to exchange a code with an access_token, and eventually</span>
<span class="sd">    refresh_token, and id_token.</span>
<span class="sd">    &quot;&quot;&quot;</span>


<span class="nd">@oidc</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">on_error</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">on_error</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This callback is called when an error is returned by the authorization</span>
<span class="sd">    server in the redirect handler.</span>
<span class="sd">    Note that this can happen for a common scenario, like the user refusing</span>
<span class="sd">    to grant consent on the application.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
<h2 id="storing-tokens">Storing tokens<a class="headerlink" href="#storing-tokens" title="Permanent link">&para;</a></h2>
<p>By default, <code>access_token</code>(s) and <code>refresh_token</code>(s) are not stored. To store
them, the <code>auth_handler.tokens_store</code> property. The examples repository includes
an example that shows how to use <code>Redis</code> to store tokens:
<em><a href="https://github.com/Neoteroi/BlackSheep-Examples/blob/main/oidc/scopes_redis_aad.py">Redis example</a></em></p>
<p>A concrete implementation is
provided in <code>CookiesTokenStore</code>, storing tokens in cookies. It is possible to
create custom implementations of the <code>TokensStore</code>, to use other mechanisms,
for example, to store tokens in a Redis cache.</p>
<p>When a user is authenticated, and has an <code>access_token</code> (and/or a
<code>refresh_token</code>), they are accessible through the <code>Identity</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">home</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="n">Identity</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">access_token</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">refresh_token</span><span class="p">)</span>
        <span class="o">...</span>
</code></pre></div>
<p>To see how to use a <code>TokensStore</code>, refer to the examples above that use
the built-in <code>CookiesTokensStore</code>.</p>
<h2 id="useful-references">Useful references<a class="headerlink" href="#useful-references" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://auth0.com/docs/security/tokens/access-tokens">https://auth0.com/docs/security/tokens/access-tokens</a></li>
<li><a href="https://www.oauth.com/oauth2-servers/server-side-apps/possible-errors/">https://www.oauth.com/oauth2-servers/server-side-apps/possible-errors/</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-implicit-grant-flow">https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-implicit-grant-flow</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-protocols-oidc">https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-protocols-oidc</a></li>
<li><a href="https://connect2id.com/learn/openid-connect">https://connect2id.com/learn/openid-connect</a></li>
</ul>
<h2 id="how-tokens-are-protected">How tokens are protected<a class="headerlink" href="#how-tokens-are-protected" title="Permanent link">&para;</a></h2>
<p>Tokens that are stored in cookies are signed and encrypted using <code>itsdangerous</code>,
with symmetric encryption. This means that BlackSheep applications need secrets
to protect sensitive data. When keys are not specified, they are generated
automatically in memory, for the best user experience.</p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>This means that keys are <strong>not persisted</strong> when applications
restart, and are not consistent when multiple instances of the same
application are deployed across regions, or within the same server. This is
acceptable during local development, but should not be the case in
production environments.</p>
</div>
<p>To use consistent keys, configure one or more environment variables like the
following:</p>
<ul>
<li>APPSECRET_1="***"</li>
<li>APPSECRET_2="***"</li>
<li>APPSECRET_3="***"</li>
</ul>
<p>Keys can be configured in a host environment, or fetched from a dedicated
service such as <code>AWS Secrets Manager</code> or <code>Azure Key Vault</code> at application
start-up, and configured as environment settings for the application.
<strong>DO NOT</strong> store secrets that are meant to be used in production
under source control.</p>
<p>For more information, refer to <a href="../dataprotection/">data protection</a>.</p>
<div class="nt-contribs"><p class="nt-mod-time">Last modified on: 2025-04-13 19:51:51</p><div class="nt-contributors"><div class="nt-contributor nt-group-0" title="Roberto Prevato &lt;roberto.prevato@gmail.com&gt; (1)"><span class="nt-initials">RP</span></div></div></div>





<!-- Giscus snippet -->
<script src="https://giscus.app/client.js"
    data-repo="Neoteroi/BlackSheep-Docs"
    data-repo-id="MDEwOlJlcG9zaXRvcnkzNzYyOTM4ODI="
    data-category="Q&A"
    data-category-id="DIC_kwDOFm3J-s4CSpF8"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="bottom"
    data-theme="dark_tritanopia"
    data-lang="en"
    data-loading="lazy"
    crossorigin="anonymous"
    async>
</script>

<!-- Synchronize Giscus theme with palette -->
<script>
  var giscus = document.querySelector("script[src*=giscus]")

  /* Set palette on initial load */
  var palette = __md_get("__palette")
  if (palette && typeof palette.color === "object") {
    var theme = palette.color.scheme === "slate" ? "dark" : "light"
    giscus.setAttribute("data-theme", theme)
  }

  /* Register event handlers after documented loaded */
  document.addEventListener("DOMContentLoaded", function() {
    var ref = document.querySelector("[data-md-component=palette]")
    ref.addEventListener("change", function() {
      var palette = __md_get("__palette")
      if (palette && typeof palette.color === "object") {
        var theme = palette.color.scheme === "slate" ? "dark" : "light"

        /* Instruct Giscus to change theme */
        var frame = document.querySelector(".giscus-frame")
        frame.contentWindow.postMessage(
          { giscus: { setConfig: { theme } } },
          "https://giscus.app"
        )
      }
    })
  })
</script>

                

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../authorization/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Authorization">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Authorization
              </div>
            </div>
          </a>
        
        
          
          <a href="../sessions/" class="md-footer__link md-footer__link--next" aria-label="Next: Sessions">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Sessions
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.footer", "content.code.copy", "content.action.view"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": 2}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="../js/fullscreen.js"></script>
      
    
  </body>
</html>